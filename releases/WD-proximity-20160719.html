<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>Proximity Sensor</title>
  <meta content="WD" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-WD" rel="stylesheet">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="Bikeshed 1.0.0" name="generator">
<style>/* style-md-lists */

            /* This is a weird hack for me not yet following the commonmark spec
               regarding paragraph and lists. */
            [data-md] > :first-child {
                margin-top: 0;
            }
            [data-md] > :last-child {
                margin-bottom: 0;
            }</style>
<style>/* style-selflinks */

            .heading, .issue, .note, .example, li, dt {
                position: relative;
            }
            a.self-link {
                position: absolute;
                top: 0;
                left: calc(-1 * (3.5rem - 26px));
                width: calc(3.5rem - 26px);
                height: 2em;
                text-align: center;
                border: none;
                transition: opacity .2s;
                opacity: .5;
            }
            a.self-link:hover {
                opacity: 1;
            }
            .heading > a.self-link {
                font-size: 83%;
            }
            li > a.self-link {
                left: calc(-1 * (3.5rem - 26px) - 2em);
            }
            dfn > a.self-link {
                top: auto;
                left: auto;
                opacity: 0;
                width: 1.5em;
                height: 1.5em;
                background: gray;
                color: white;
                font-style: normal;
                transition: opacity .2s, background-color .2s, color .2s;
            }
            dfn:hover > a.self-link {
                opacity: 1;
            }
            dfn > a.self-link:hover {
                color: black;
            }

            a.self-link::before            { content: "¶"; }
            .heading > a.self-link::before { content: "§"; }
            dfn > a.self-link::before      { content: "#"; }</style>
<style>/* style-counters */

            body {
                counter-reset: example figure issue;
            }
            .issue {
                counter-increment: issue;
            }
            .issue:not(.no-marker)::before {
                content: "Issue " counter(issue);
            }

            .example {
                counter-increment: example;
            }
            .example:not(.no-marker)::before {
                content: "Example " counter(example);
            }
            .invalid.example:not(.no-marker)::before,
            .illegal.example:not(.no-marker)::before {
                content: "Invalid Example" counter(example);
            }

            figcaption {
                counter-increment: figure;
            }
            figcaption:not(.no-marker)::before {
                content: "Figure " counter(figure);
            }</style>
<style>/* style-autolinks */

            .css.css, .property.property, .descriptor.descriptor {
                color: #005a9c;
                font-size: inherit;
                font-family: inherit;
            }
            .css::before, .property::before, .descriptor::before {
                content: "‘";
            }
            .css::after, .property::after, .descriptor::after {
                content: "’";
            }
            .property, .descriptor {
                /* Don't wrap property and descriptor names */
                white-space: nowrap;
            }
            .type { /* CSS value <type> */
                font-style: italic;
            }
            pre .property::before, pre .property::after {
                content: "";
            }
            [data-link-type="property"]::before,
            [data-link-type="propdesc"]::before,
            [data-link-type="descriptor"]::before,
            [data-link-type="value"]::before,
            [data-link-type="function"]::before,
            [data-link-type="at-rule"]::before,
            [data-link-type="selector"]::before,
            [data-link-type="maybe"]::before {
                content: "‘";
            }
            [data-link-type="property"]::after,
            [data-link-type="propdesc"]::after,
            [data-link-type="descriptor"]::after,
            [data-link-type="value"]::after,
            [data-link-type="function"]::after,
            [data-link-type="at-rule"]::after,
            [data-link-type="selector"]::after,
            [data-link-type="maybe"]::after {
                content: "’";
            }

            [data-link-type].production::before,
            [data-link-type].production::after,
            .prod [data-link-type]::before,
            .prod [data-link-type]::after {
                content: "";
            }

            [data-link-type=element],
            [data-link-type=element-attr] {
                font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
                font-size: .9em;
            }
            [data-link-type=element]::before { content: "<" }
            [data-link-type=element]::after  { content: ">" }

            [data-link-type=biblio] {
                white-space: pre;
            }</style>
<style>/* style-dfn-panel */

        .dfn-panel {
            position: absolute;
            z-index: 35;
            height: auto;
            width: -webkit-fit-content;
            width: fit-content;
            max-width: 300px;
            max-height: 500px;
            overflow: auto;
            padding: 0.5em 0.75em;
            font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
            background: #DDDDDD;
            color: black;
            border: outset 0.2em;
        }
        .dfn-panel:not(.on) { display: none; }
        .dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
        .dfn-panel > b { display: block; }
        .dfn-panel a { color: black; }
        .dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
        .dfn-panel > b + b { margin-top: 0.25em; }
        .dfn-panel ul { padding: 0; }
        .dfn-panel li { list-style: inside; }
        .dfn-panel.activated {
            display: inline-block;
            position: fixed;
            left: .5em;
            bottom: 2em;
            margin: 0 auto;
            max-width: calc(100vw - 1.5em - .4em - .5em);
            max-height: 30vh;
        }

        .dfn-paneled { cursor: pointer; }
        </style>
<style>/* style-syntax-highlighting */
pre.idl.highlight { color: #708090; }
        .highlight:not(.idl) { background: hsl(24, 20%, 95%); }
        code.highlight { padding: .1em; border-radius: .3em; }
        pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }
        .highlight .c { color: #708090 } /* Comment */
        .highlight .k { color: #990055 } /* Keyword */
        .highlight .l { color: #000000 } /* Literal */
        .highlight .n { color: #0077aa } /* Name */
        .highlight .o { color: #999999 } /* Operator */
        .highlight .p { color: #999999 } /* Punctuation */
        .highlight .cm { color: #708090 } /* Comment.Multiline */
        .highlight .cp { color: #708090 } /* Comment.Preproc */
        .highlight .c1 { color: #708090 } /* Comment.Single */
        .highlight .cs { color: #708090 } /* Comment.Special */
        .highlight .kc { color: #990055 } /* Keyword.Constant */
        .highlight .kd { color: #990055 } /* Keyword.Declaration */
        .highlight .kn { color: #990055 } /* Keyword.Namespace */
        .highlight .kp { color: #990055 } /* Keyword.Pseudo */
        .highlight .kr { color: #990055 } /* Keyword.Reserved */
        .highlight .kt { color: #990055 } /* Keyword.Type */
        .highlight .ld { color: #000000 } /* Literal.Date */
        .highlight .m { color: #000000 } /* Literal.Number */
        .highlight .s { color: #a67f59 } /* Literal.String */
        .highlight .na { color: #0077aa } /* Name.Attribute */
        .highlight .nc { color: #0077aa } /* Name.Class */
        .highlight .no { color: #0077aa } /* Name.Constant */
        .highlight .nd { color: #0077aa } /* Name.Decorator */
        .highlight .ni { color: #0077aa } /* Name.Entity */
        .highlight .ne { color: #0077aa } /* Name.Exception */
        .highlight .nf { color: #0077aa } /* Name.Function */
        .highlight .nl { color: #0077aa } /* Name.Label */
        .highlight .nn { color: #0077aa } /* Name.Namespace */
        .highlight .py { color: #0077aa } /* Name.Property */
        .highlight .nt { color: #669900 } /* Name.Tag */
        .highlight .nv { color: #222222 } /* Name.Variable */
        .highlight .ow { color: #999999 } /* Operator.Word */
        .highlight .mb { color: #000000 } /* Literal.Number.Bin */
        .highlight .mf { color: #000000 } /* Literal.Number.Float */
        .highlight .mh { color: #000000 } /* Literal.Number.Hex */
        .highlight .mi { color: #000000 } /* Literal.Number.Integer */
        .highlight .mo { color: #000000 } /* Literal.Number.Oct */
        .highlight .sb { color: #a67f59 } /* Literal.String.Backtick */
        .highlight .sc { color: #a67f59 } /* Literal.String.Char */
        .highlight .sd { color: #a67f59 } /* Literal.String.Doc */
        .highlight .s2 { color: #a67f59 } /* Literal.String.Double */
        .highlight .se { color: #a67f59 } /* Literal.String.Escape */
        .highlight .sh { color: #a67f59 } /* Literal.String.Heredoc */
        .highlight .si { color: #a67f59 } /* Literal.String.Interpol */
        .highlight .sx { color: #a67f59 } /* Literal.String.Other */
        .highlight .sr { color: #a67f59 } /* Literal.String.Regex */
        .highlight .s1 { color: #a67f59 } /* Literal.String.Single */
        .highlight .ss { color: #a67f59 } /* Literal.String.Symbol */
        .highlight .vc { color: #0077aa } /* Name.Variable.Class */
        .highlight .vg { color: #0077aa } /* Name.Variable.Global */
        .highlight .vi { color: #0077aa } /* Name.Variable.Instance */
        .highlight .il { color: #000000 } /* Literal.Number.Integer.Long */
        </style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="http://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">Proximity Sensor</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">W3C Working Draft, <time class="dt-updated" datetime="2016-07-19">19 July 2016</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://www.w3.org/TR/2016/WD-proximity-20160719/">http://www.w3.org/TR/2016/WD-proximity-20160719/</a>
     <dt>Latest published version:
     <dd><a href="https://www.w3.org/TR/proximity/">https://www.w3.org/TR/proximity/</a>
     <dt>Editor's Draft:
     <dd><a href="https://w3c.github.io/proximity/">https://w3c.github.io/proximity/</a>
     <dt>Previous Versions:
     <dd><a href="https://www.w3.org/TR/2015/WD-proximity-20150903/" rel="previous">https://www.w3.org/TR/2015/WD-proximity-20150903/</a>
     <dt>Version History:
     <dd><a href="https://github.com/w3c/proximity/commits/gh-pages/index.bs">https://github.com/w3c/proximity/commits/gh-pages/index.bs</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-device-apis@w3.org?subject=%5Bproximity%5D%20YOUR%20TOPIC%20HERE">public-device-apis@w3.org</a> with subject line “<kbd>[proximity] <i data-lt="">… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-device-apis/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/w3c/proximity/issues/">GitHub</a>
     <dd><span><a href="https://github.com/w3c/proximity/issues">Issues</a></span>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard" data-editor-id="41974"><a class="p-name fn u-url url" href="https://intel.com/">Anssi Kostiainen</a> (<span class="p-org org">Intel Corporation</span>)
     <dd class="editor p-author h-card vcard" data-editor-id="80407"><a class="p-name fn u-url url" href="https://intel.com/">Rijubrata Bhaumik</a> (<span class="p-org org">Intel Corporation</span>)
     <dt class="editor">Former Editor:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-url url" href="https://intel.com/">Dzung D Tran</a> (<span class="p-org org">Intel Corporation</span>)
     <dt>Bug Reports:
     <dd><span><a href="https://www.github.com/w3c/proximity/issues/new">via the w3c/proximity repository on GitHub</a></span>
     <dt>Test Suite:
     <dd><span><a href="https://github.com/w3c/web-platform-tests/tree/master/proximity">web-platform-tests on GitHub</a></span>
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2016 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/2015/copyright-software-and-document">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
  <div class="p-summary" data-fill-with="abstract">
   <p>This specification defines a concrete sensor interface to monitor

the presence of nearby objects without physical contact.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p> <em>This section describes the status of this document at the time of
  its publication. Other documents may supersede this document. A list of
  current W3C publications and the latest revision of this technical report
  can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
  index at http://www.w3.org/TR/.</a></em> </p>
   <p> This document was published by the <a href="http://www.w3.org/2009/dap/">Device and Sensors Working Group</a> as a Working Draft. This document is intended to become a W3C Recommendation. </p>
   <p> If you wish to make comments regarding this document, please send them to <a href="mailto:public-device-apis@w3.org?Subject=%5Bproximity%5D%20PUT%20SUBJECT%20HERE">public-device-apis@w3.org</a> (<a href="mailto:public-device-apis-request@w3.org?subject=subscribe">subscribe</a>, <a href="http://lists.w3.org/Archives/Public/public-device-apis/">archives</a>).
	When sending e-mail,
	please put the text “proximity” in the subject,
	preferably like this:
	“[proximity] <em>…summary of comment…</em>”.
	All comments are welcome. </p>
   <p> Publication as a Working Draft does not imply endorsement by the W3C
  Membership. This is a draft document and may be updated, replaced or
  obsoleted by other documents at any time. It is inappropriate to cite this
  document as other than work in progress. </p>
   <p> This document was produced by a group operating under
	the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/2004/01/pp-impl/43696/status" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p> This document is governed by the <a href="http://www.w3.org/2015/Process-20150901/" id="w3c_process_revision">1 September 2015 W3C Process Document</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li><a href="#examples"><span class="secno">2</span> <span class="content">Examples</span></a>
    <li><a href="#security-and-privacy"><span class="secno">3</span> <span class="content">Security and Privacy Considerations</span></a>
    <li><a href="#model"><span class="secno">4</span> <span class="content">Model</span></a>
    <li>
     <a href="#api"><span class="secno">5</span> <span class="content">API</span></a>
     <ol class="toc">
      <li><a href="#proximity-sensor-interface"><span class="secno">5.1</span> <span class="content">The ProximitySensor Interface</span></a>
      <li>
       <a href="#proximity-sensor-reading-interface"><span class="secno">5.2</span> <span class="content">The ProximitySensorReading Interface</span></a>
       <ol class="toc">
        <li><a href="#proximity-sensor-reading-constructor"><span class="secno">5.2.1</span> <span class="content">The ProximitySensorReading constructor</span></a>
        <li><a href="#proximity-sensor-reading-attribute-distance"><span class="secno">5.2.2</span> <span class="content">The distance attribute</span></a>
        <li><a href="#proximity-sensor-reading-attribute-max"><span class="secno">5.2.3</span> <span class="content">The max attribute</span></a>
        <li><a href="#proximity-sensor-reading-attribute-near"><span class="secno">5.2.4</span> <span class="content">The near attribute</span></a>
       </ol>
     </ol>
    <li><a href="#limitations-proximity-sensors"><span class="secno">6</span> <span class="content">Limitations of Proximity Sensors</span></a>
    <li><a href="#acknowledgements"><span class="secno">7</span> <span class="content">Acknowledgements</span></a>
    <li>
     <a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformance-classes"><span class="secno"></span> <span class="content">Conformance Classes</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>The Proximity Sensor extends the Generic Sensor API <a data-link-type="biblio" href="#biblio-generic-sensor">[GENERIC-SENSOR]</a> to provide information about proximity level, as detected by the device’s primary
proximity sensor. The proximity level is reported as the distance (in centimeter)
from the sensor to the closest visible surface. <a href="#limitations-proximity-sensors">§6 Limitations of Proximity Sensors</a> describes more about the potential limitations, why the precise distance value
reported by different devices can be different, due to differences in detection
method, sensor construction, etc.  Moreover some proximity sensors might be only
able to provide just a boolean to indicate if there is an object which is near,
more like presence detection, than an absolute value for the distance.</p>
   <h2 class="heading settled" data-level="2" id="examples"><span class="secno">2. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <div class="example" id="example-bfea9999">
    <a class="self-link" href="#example-bfea9999"></a> 
<pre class="highlight"><span class="kd">let</span> <span class="nx">sensor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProximitySensor</span><span class="p">();</span>
<span class="nx">sensor</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>

<span class="nx">sensor</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="nx">event</span> <span class="o">=></span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">reading</span><span class="p">.</span><span class="nx">distance</span><span class="p">);</span>

<span class="nx">sensor</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
<span class="p">};</span>
</pre>
   </div>
   <h2 class="heading settled" data-level="3" id="security-and-privacy"><span class="secno">3. </span><span class="content">Security and Privacy Considerations</span><a class="self-link" href="#security-and-privacy"></a></h2>
   <p>There are no specific security and privacy considerations
beyond those described in the Generic Sensor API <a data-link-type="biblio" href="#biblio-generic-sensor">[GENERIC-SENSOR]</a>.</p>
   <h2 class="heading settled" data-level="4" id="model"><span class="secno">4. </span><span class="content">Model</span><a class="self-link" href="#model"></a></h2>
   <p>The Proximity Sensor’s associated <a data-link-type="dfn" href="https://w3c.github.io/sensors#sensor-subclass">Sensor subclass</a> is the <code class="idl"><a data-link-type="idl" href="#proximitysensor" id="ref-for-proximitysensor-1">ProximitySensor</a></code> class.</p>
   <p>The Proximity Sensor’s associated <a data-link-type="dfn" href="https://w3c.github.io/sensors#sensorreading-subclass">SensorReading subclass</a> is the <code class="idl"><a data-link-type="idl" href="#proximitysensorreading" id="ref-for-proximitysensorreading-1">ProximitySensorReading</a></code> class.</p>
   <p>The Proximity Sensor has a <a data-link-type="dfn" href="https://w3c.github.io/sensors#default-sensor">default sensor</a>,
which is the device’s main proximity detector.</p>
   <p>The Proximity Sensor has a single <a data-link-type="dfn" href="https://w3c.github.io/sensors#supported-reporting-modes">supported reporting mode</a> which is "<a data-link-type="dfn" href="https://w3c.github.io/sensors#auto">auto</a>".</p>
   <p>The Proximity Sensor’s <a data-link-type="dfn" href="https://w3c.github.io/permissions/#idl-def-Permission">permission</a> name is <code>"proximity"</code>.
It has no <a data-link-type="dfn" href="https://w3c.github.io/permissions/#dfn-associated-permissiondescriptor">associated PermissionDescriptor</a>.</p>
   <p>The Proximity Sensor has an associated abstract operation
to <dfn data-dfn-type="dfn" data-noexport="" id="retrieve-the-sensor-permission">retrieve the sensor permission<a class="self-link" href="#retrieve-the-sensor-permission"></a></dfn> which
must simply return a <a data-link-type="dfn" href="https://w3c.github.io/permissions/#idl-def-Permission">permission</a> whose name is "proximity".</p>
   <p>The Proximity Sensor has an associated abstract operation
to <dfn data-dfn-type="dfn" data-lt="Construct SensorReading Object" data-noexport="" id="construct-sensorreading-object">construct a SensorReading object<a class="self-link" href="#construct-sensorreading-object"></a></dfn> which creates a new <code class="idl"><a data-link-type="idl" href="#proximitysensorreading" id="ref-for-proximitysensorreading-2">ProximitySensorReading</a></code> object and sets its <a class="idl-code" data-link-type="attribute" href="#dom-proximitysensorreading-distance" id="ref-for-dom-proximitysensorreading-distance-1">distance</a> attribute to
positive infinity.</p>
   <p><dfn data-dfn-type="dfn" data-noexport="" id="distance">Distance<a class="self-link" href="#distance"></a></dfn> is a value that represents the distance between a device and
the closest visible surface. Its unit is the centimeter (cm).</p>
   <h2 class="heading settled" data-level="5" id="api"><span class="secno">5. </span><span class="content">API</span><a class="self-link" href="#api"></a></h2>
   <h3 class="heading settled" data-level="5.1" id="proximity-sensor-interface"><span class="secno">5.1. </span><span class="content">The ProximitySensor Interface</span><a class="self-link" href="#proximity-sensor-interface"></a></h3>
<pre class="idl highlight def">[<dfn class="nv idl-code" data-dfn-for="ProximitySensor" data-dfn-type="constructor" data-export="" data-lt="ProximitySensor(sensorOptions)|ProximitySensor()" id="dom-proximitysensor-proximitysensor">Constructor<a class="self-link" href="#dom-proximitysensor-proximitysensor"></a></dfn>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/generic-sensor/#dictdef-sensoroptions">SensorOptions</a> <dfn class="nv idl-code" data-dfn-for="ProximitySensor/ProximitySensor(sensorOptions)" data-dfn-type="argument" data-export="" id="dom-proximitysensor-proximitysensor-sensoroptions-sensoroptions">sensorOptions<a class="self-link" href="#dom-proximitysensor-proximitysensor-sensoroptions-sensoroptions"></a></dfn>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="proximitysensor">ProximitySensor</dfn> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/generic-sensor/#sensor">Sensor</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#proximitysensorreading" id="ref-for-proximitysensorreading-3">ProximitySensorReading</a>? <dfn class="nv idl-code" data-dfn-for="ProximitySensor" data-dfn-type="attribute" data-export="" data-readonly="" data-type="ProximitySensorReading?" id="dom-proximitysensor-reading">reading<a class="self-link" href="#dom-proximitysensor-reading"></a></dfn>;
};
</pre>
   <p>To <dfn data-dfn-type="dfn" data-noexport="" id="construct-a-proximitysensor-object">Construct a ProximitySensor Object<a class="self-link" href="#construct-a-proximitysensor-object"></a></dfn> the user agent must invoke the <a data-link-type="dfn" href="https://w3c.github.io/sensors#construct-sensor-object">construct a Sensor object</a> abstract operation.</p>
   <h3 class="heading settled" data-level="5.2" id="proximity-sensor-reading-interface"><span class="secno">5.2. </span><span class="content">The ProximitySensorReading Interface</span><a class="self-link" href="#proximity-sensor-reading-interface"></a></h3>
<pre class="idl highlight def">[<dfn class="nv idl-code" data-dfn-for="ProximitySensorReading" data-dfn-type="constructor" data-export="" data-lt="ProximitySensorReading(proximitySensorReadingInit)" id="dom-proximitysensorreading-proximitysensorreading">Constructor<a class="self-link" href="#dom-proximitysensorreading-proximitysensorreading"></a></dfn>(<a class="n" data-link-type="idl-name" href="#dictdef-proximitysensorreadinginit" id="ref-for-dictdef-proximitysensorreadinginit-1">ProximitySensorReadingInit</a> <dfn class="nv idl-code" data-dfn-for="ProximitySensorReading/ProximitySensorReading(proximitySensorReadingInit)" data-dfn-type="argument" data-export="" id="dom-proximitysensorreading-proximitysensorreading-proximitysensorreadinginit-proximitysensorreadinginit">proximitySensorReadingInit<a class="self-link" href="#dom-proximitysensorreading-proximitysensorreading-proximitysensorreadinginit-proximitysensorreadinginit"></a></dfn>)]
<span class="kt">interface</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="interface" data-export="" id="proximitysensorreading">ProximitySensorReading</dfn> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/generic-sensor/#sensorreading">SensorReading</a> {
    <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">unrestricted</span> <span class="kt">double</span> <dfn class="nv dfn-paneled idl-code" data-dfn-for="ProximitySensorReading" data-dfn-type="attribute" data-export="" data-readonly="" data-type="unrestricted double" id="dom-proximitysensorreading-distance">distance</dfn>;
    <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">unrestricted</span> <span class="kt">double</span> <dfn class="nv dfn-paneled idl-code" data-dfn-for="ProximitySensorReading" data-dfn-type="attribute" data-export="" data-readonly="" data-type="unrestricted double" id="dom-proximitysensorreading-max">max</dfn>;
    <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">boolean</span>? <dfn class="nv dfn-paneled idl-code" data-dfn-for="ProximitySensorReading" data-dfn-type="attribute" data-export="" data-readonly="" data-type="boolean?" id="dom-proximitysensorreading-near">near</dfn>;
};

<span class="kt">dictionary</span> <dfn class="nv dfn-paneled idl-code" data-dfn-type="dictionary" data-export="" id="dictdef-proximitysensorreadinginit">ProximitySensorReadingInit</dfn> {
  <span class="kt">unrestricted</span> <span class="kt">double</span> <dfn class="nv idl-code" data-default="Infinity" data-dfn-for="ProximitySensorReadingInit" data-dfn-type="dict-member" data-export="" data-type="unrestricted double " id="dom-proximitysensorreadinginit-distance">distance<a class="self-link" href="#dom-proximitysensorreadinginit-distance"></a></dfn> = <span class="kt">Infinity</span>;
  <span class="kt">unrestricted</span> <span class="kt">double</span> <dfn class="nv idl-code" data-default="Infinity" data-dfn-for="ProximitySensorReadingInit" data-dfn-type="dict-member" data-export="" data-type="unrestricted double " id="dom-proximitysensorreadinginit-max">max<a class="self-link" href="#dom-proximitysensorreadinginit-max"></a></dfn> = <span class="kt">Infinity</span>;
  <span class="kt">boolean</span>? <dfn class="nv idl-code" data-dfn-for="ProximitySensorReadingInit" data-dfn-type="dict-member" data-export="" data-type="boolean? " id="dom-proximitysensorreadinginit-near">near<a class="self-link" href="#dom-proximitysensorreadinginit-near"></a></dfn>;
};
</pre>
   <h4 class="heading settled" data-level="5.2.1" id="proximity-sensor-reading-constructor"><span class="secno">5.2.1. </span><span class="content">The ProximitySensorReading constructor</span><a class="self-link" href="#proximity-sensor-reading-constructor"></a></h4>
   <h4 class="heading settled" data-level="5.2.2" id="proximity-sensor-reading-attribute-distance"><span class="secno">5.2.2. </span><span class="content">The distance attribute</span><a class="self-link" href="#proximity-sensor-reading-attribute-distance"></a></h4>
   <p>The <a class="idl-code" data-link-type="attribute" href="#dom-proximitysensorreading-distance" id="ref-for-dom-proximitysensorreading-distance-2">distance</a> attribute of the <code class="idl"><a data-link-type="idl" href="#proximitysensorreading" id="ref-for-proximitysensorreading-4">ProximitySensorReading</a></code> interface represents the distance between the sensor and the closest visible surface, in centimeters.</p>
   <h4 class="heading settled" data-level="5.2.3" id="proximity-sensor-reading-attribute-max"><span class="secno">5.2.3. </span><span class="content">The max attribute</span><a class="self-link" href="#proximity-sensor-reading-attribute-max"></a></h4>
   <p>The <a class="idl-code" data-link-type="attribute" href="#dom-proximitysensorreading-max" id="ref-for-dom-proximitysensorreading-max-1">max</a> attribute of the <code class="idl"><a data-link-type="idl" href="#proximitysensorreading" id="ref-for-proximitysensorreading-5">ProximitySensorReading</a></code> interface represents the maximum sensing range for the primary proximity sensor, in centimeters.</p>
   <h4 class="heading settled" data-level="5.2.4" id="proximity-sensor-reading-attribute-near"><span class="secno">5.2.4. </span><span class="content">The near attribute</span><a class="self-link" href="#proximity-sensor-reading-attribute-near"></a></h4>
   <p>The <a class="idl-code" data-link-type="attribute" href="#dom-proximitysensorreading-near" id="ref-for-dom-proximitysensorreading-near-1">near</a> attribute of the <code class="idl"><a data-link-type="idl" href="#proximitysensorreading" id="ref-for-proximitysensorreading-6">ProximitySensorReading</a></code> interface represents the the presence of a visible surface in the vicinity of the primary proximity sensor, in centimeters.</p>
   <p class="note" role="note">Note: If the implementation is unable to provide the <code class="idl"><a data-link-type="idl" href="#dom-proximitysensorreading-near" id="ref-for-dom-proximitysensorreading-near-2">near</a></code> value, it could infer the <code class="idl"><a data-link-type="idl" href="#dom-proximitysensorreading-near" id="ref-for-dom-proximitysensorreading-near-3">near</a></code> value from the value of <code class="idl"><a data-link-type="idl" href="#dom-proximitysensorreading-distance" id="ref-for-dom-proximitysensorreading-distance-3">distance</a></code>.
For example, if <code class="idl"><a data-link-type="idl" href="#dom-proximitysensorreading-distance" id="ref-for-dom-proximitysensorreading-distance-4">distance</a></code> is not equal to <code class="idl"><a data-link-type="idl" href="#dom-proximitysensorreading-max" id="ref-for-dom-proximitysensorreading-max-2">max</a></code> or default value (Infinity),
it could imply there is an object in the sensing range.</p>
   <h2 class="heading settled" data-level="6" id="limitations-proximity-sensors"><span class="secno">6. </span><span class="content">Limitations of Proximity Sensors</span><a class="self-link" href="#limitations-proximity-sensors"></a></h2>
   <p>Since most proximity sensors detect electromagnetic radiation (e.g., an infrared light
or a magnetic field), certain material properties can interfere with the sensor’s
ability to sense the presence of a physical object. Things that can interfere with
a sensor include, but are not limited to, the material’s translucency, reflectiveness,
color, temperature, chemical composition, and even the angle at which the object
is reflecting the radiation back at the sensor. As such, proximity sensors
should not be relied on as a means to measure distance. The only thing that can
be deduced from a proximity sensor is that an object is somewhere in the
distance between the minimum sensing distance and the maximum sensing distance
with some degree of certainty.</p>
   <h2 class="heading settled" data-level="7" id="acknowledgements"><span class="secno">7. </span><span class="content">Acknowledgements</span><a class="self-link" href="#acknowledgements"></a></h2>
   <p>Tobie Langel for the work on Generic Sensor API and inputs on this specification.
Doug Turner for the initial prototype and
Marcos Caceres for the test suite.</p>
   <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>
   <p>Conformance requirements are expressed with a combination of
     descriptive assertions and RFC 2119 terminology. The key words "MUST",
     "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
     "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
     document are to be interpreted as described in RFC 2119.
     However, for readability, these words do not appear in all uppercase
     letters in this specification. </p>
   <p>All of the text of this specification is normative except sections
     explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
   <h3 class="no-ref no-num heading settled" id="conformance-classes"><span class="content">Conformance Classes</span><a class="self-link" href="#conformance-classes"></a></h3>
   <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-user-agent">conformant user agent<a class="self-link" href="#conformant-user-agent"></a></dfn> must implement all the requirements
     listed in this specification that are applicable to user agents.</p>
  </main>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#conformant-user-agent">conformant user agent</a><span>, in §Unnumbered section</span>
   <li><a href="#construct-a-proximitysensor-object">Construct a ProximitySensor Object</a><span>, in §5.1</span>
   <li><a href="#construct-sensorreading-object">Construct SensorReading Object</a><span>, in §4</span>
   <li><a href="#distance">Distance</a><span>, in §4</span>
   <li>
    distance
    <ul>
     <li><a href="#dom-proximitysensorreading-distance">attribute for ProximitySensorReading</a><span>, in §5.2</span>
     <li><a href="#dom-proximitysensorreadinginit-distance">dict-member for ProximitySensorReadingInit</a><span>, in §5.2</span>
    </ul>
   <li>
    max
    <ul>
     <li><a href="#dom-proximitysensorreading-max">attribute for ProximitySensorReading</a><span>, in §5.2</span>
     <li><a href="#dom-proximitysensorreadinginit-max">dict-member for ProximitySensorReadingInit</a><span>, in §5.2</span>
    </ul>
   <li>
    near
    <ul>
     <li><a href="#dom-proximitysensorreading-near">attribute for ProximitySensorReading</a><span>, in §5.2</span>
     <li><a href="#dom-proximitysensorreadinginit-near">dict-member for ProximitySensorReadingInit</a><span>, in §5.2</span>
    </ul>
   <li><a href="#proximitysensor">ProximitySensor</a><span>, in §5.1</span>
   <li><a href="#dom-proximitysensor-proximitysensor">ProximitySensor()</a><span>, in §5.1</span>
   <li><a href="#proximitysensorreading">ProximitySensorReading</a><span>, in §5.2</span>
   <li><a href="#dictdef-proximitysensorreadinginit">ProximitySensorReadingInit</a><span>, in §5.2</span>
   <li><a href="#dom-proximitysensorreading-proximitysensorreading">ProximitySensorReading(proximitySensorReadingInit)</a><span>, in §5.2</span>
   <li><a href="#dom-proximitysensor-proximitysensor">ProximitySensor(sensorOptions)</a><span>, in §5.1</span>
   <li><a href="#dom-proximitysensor-reading">reading</a><span>, in §5.1</span>
   <li><a href="#retrieve-the-sensor-permission">retrieve the sensor permission</a><span>, in §4</span>
  </ul>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[GENERIC-SENSOR]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/sensors#auto">auto</a>
     <li><a href="https://w3c.github.io/sensors#construct-sensor-object">construct a sensor object</a>
     <li><a href="https://w3c.github.io/sensors#default-sensor">default sensor</a>
     <li><a href="https://w3c.github.io/sensors#sensor-subclass">sensor subclass</a>
     <li><a href="https://w3c.github.io/sensors#sensorreading-subclass">sensorreading subclass</a>
     <li><a href="https://w3c.github.io/sensors#supported-reporting-modes">supported reporting mode</a>
    </ul>
   <li>
    <a data-link-type="biblio">[permissions]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/permissions/#dfn-associated-permissiondescriptor">associated permissiondescriptor</a>
     <li><a href="https://w3c.github.io/permissions/#idl-def-Permission">permission</a>
    </ul>
   <li>
    <a data-link-type="biblio">[GENERIC-SENSOR]</a> defines the following terms:
    <ul>
     <li><a href="https://www.w3.org/TR/generic-sensor/#sensor">Sensor</a>
     <li><a href="https://www.w3.org/TR/generic-sensor/#dictdef-sensoroptions">SensorOptions</a>
     <li><a href="https://www.w3.org/TR/generic-sensor/#sensorreading">SensorReading</a>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-generic-sensor">[GENERIC-SENSOR]
   <dd>Tobie Langel; Rick Waldron. <a href="https://www.w3.org/TR/generic-sensor/">Generic Sensor API</a>. 24 March 2016. WD. URL: <a href="https://www.w3.org/TR/generic-sensor/">https://www.w3.org/TR/generic-sensor/</a>
   <dt id="biblio-permissions">[PERMISSIONS]
   <dd>Mounir Lamouri; Marcos Caceres. <a href="https://www.w3.org/TR/permissions/">The Permissions API</a>. 7 April 2015. WD. URL: <a href="https://www.w3.org/TR/permissions/">https://www.w3.org/TR/permissions/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl def">[<a class="nv" href="#dom-proximitysensor-proximitysensor">Constructor</a>(<span class="kt">optional</span> <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/generic-sensor/#dictdef-sensoroptions">SensorOptions</a> <a class="nv" href="#dom-proximitysensor-proximitysensor-sensoroptions-sensoroptions">sensorOptions</a>)]
<span class="kt">interface</span> <a class="nv" href="#proximitysensor">ProximitySensor</a> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/generic-sensor/#sensor">Sensor</a> {
  <span class="kt">readonly</span> <span class="kt">attribute</span> <a class="n" data-link-type="idl-name" href="#proximitysensorreading">ProximitySensorReading</a>? <a class="nv" data-readonly="" data-type="ProximitySensorReading?" href="#dom-proximitysensor-reading">reading</a>;
};

[<a class="nv" href="#dom-proximitysensorreading-proximitysensorreading">Constructor</a>(<a class="n" data-link-type="idl-name" href="#dictdef-proximitysensorreadinginit">ProximitySensorReadingInit</a> <a class="nv" href="#dom-proximitysensorreading-proximitysensorreading-proximitysensorreadinginit-proximitysensorreadinginit">proximitySensorReadingInit</a>)]
<span class="kt">interface</span> <a class="nv" href="#proximitysensorreading">ProximitySensorReading</a> : <a class="n" data-link-type="idl-name" href="https://www.w3.org/TR/generic-sensor/#sensorreading">SensorReading</a> {
    <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">unrestricted</span> <span class="kt">double</span> <a class="nv" data-readonly="" data-type="unrestricted double" href="#dom-proximitysensorreading-distance">distance</a>;
    <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">unrestricted</span> <span class="kt">double</span> <a class="nv" data-readonly="" data-type="unrestricted double" href="#dom-proximitysensorreading-max">max</a>;
    <span class="kt">readonly</span> <span class="kt">attribute</span> <span class="kt">boolean</span>? <a class="nv" data-readonly="" data-type="boolean?" href="#dom-proximitysensorreading-near">near</a>;
};

<span class="kt">dictionary</span> <a class="nv" href="#dictdef-proximitysensorreadinginit">ProximitySensorReadingInit</a> {
  <span class="kt">unrestricted</span> <span class="kt">double</span> <a class="nv" data-default="Infinity" data-type="unrestricted double " href="#dom-proximitysensorreadinginit-distance">distance</a> = <span class="kt">Infinity</span>;
  <span class="kt">unrestricted</span> <span class="kt">double</span> <a class="nv" data-default="Infinity" data-type="unrestricted double " href="#dom-proximitysensorreadinginit-max">max</a> = <span class="kt">Infinity</span>;
  <span class="kt">boolean</span>? <a class="nv" data-type="boolean? " href="#dom-proximitysensorreadinginit-near">near</a>;
};

</pre>
  <aside class="dfn-panel" data-for="proximitysensor">
   <b><a href="#proximitysensor">#proximitysensor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-proximitysensor-1">4. Model</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="proximitysensorreading">
   <b><a href="#proximitysensorreading">#proximitysensorreading</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-proximitysensorreading-1">4. Model</a> <a href="#ref-for-proximitysensorreading-2">(2)</a>
    <li><a href="#ref-for-proximitysensorreading-3">5.1. The ProximitySensor Interface</a>
    <li><a href="#ref-for-proximitysensorreading-4">5.2.2. The distance attribute</a>
    <li><a href="#ref-for-proximitysensorreading-5">5.2.3. The max attribute</a>
    <li><a href="#ref-for-proximitysensorreading-6">5.2.4. The near attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-proximitysensorreading-distance">
   <b><a href="#dom-proximitysensorreading-distance">#dom-proximitysensorreading-distance</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-proximitysensorreading-distance-1">4. Model</a>
    <li><a href="#ref-for-dom-proximitysensorreading-distance-2">5.2.2. The distance attribute</a>
    <li><a href="#ref-for-dom-proximitysensorreading-distance-3">5.2.4. The near attribute</a> <a href="#ref-for-dom-proximitysensorreading-distance-4">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-proximitysensorreading-max">
   <b><a href="#dom-proximitysensorreading-max">#dom-proximitysensorreading-max</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-proximitysensorreading-max-1">5.2.3. The max attribute</a>
    <li><a href="#ref-for-dom-proximitysensorreading-max-2">5.2.4. The near attribute</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-proximitysensorreading-near">
   <b><a href="#dom-proximitysensorreading-near">#dom-proximitysensorreading-near</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-proximitysensorreading-near-1">5.2.4. The near attribute</a> <a href="#ref-for-dom-proximitysensorreading-near-2">(2)</a> <a href="#ref-for-dom-proximitysensorreading-near-3">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-proximitysensorreadinginit">
   <b><a href="#dictdef-proximitysensorreadinginit">#dictdef-proximitysensorreadinginit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-proximitysensorreadinginit-1">5.2. The ProximitySensorReading Interface</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

        document.body.addEventListener("click", function(e) {
            var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
            // Find the dfn element or panel, if any, that was clicked on.
            var el = e.target;
            var target;
            var hitALink = false;
            while(el.parentElement) {
                if(el.tagName == "A") {
                    // Clicking on a link in a <dfn> shouldn't summon the panel
                    hitALink = true;
                }
                if(el.classList.contains("dfn-paneled")) {
                    target = "dfn";
                    break;
                }
                if(el.classList.contains("dfn-panel")) {
                    target = "dfn-panel";
                    break;
                }
                el = el.parentElement;
            }
            if(target != "dfn-panel") {
                // Turn off any currently "on" or "activated" panels.
                queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
                    el.classList.remove("on");
                    el.classList.remove("activated");
                });
            }
            if(target == "dfn" && !hitALink) {
                // open the panel
                var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
                if(dfnPanel) {
                    console.log(dfnPanel);
                    dfnPanel.classList.add("on");
                    var rect = el.getBoundingClientRect();
                    dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
                    dfnPanel.style.top = window.scrollY + rect.top + "px";
                    var panelRect = dfnPanel.getBoundingClientRect();
                    var panelWidth = panelRect.right - panelRect.left;
                    if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                        // Reposition, because the panel is overflowing
                        dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
                    }
                } else {
                    console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
                }
            } else if(target == "dfn-panel") {
                // Switch it to "activated" state, which pins it.
                el.classList.add("activated");
                el.style.left = null;
                el.style.top = null;
            }

        });
        </script>